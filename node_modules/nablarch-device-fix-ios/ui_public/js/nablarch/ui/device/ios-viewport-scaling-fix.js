/**
 * iOSビューポート制御不具合修正
 * ================================================
 * iOSデバイスにおいて、viewportをdevice-widthに設定しかつユーザによる拡大・縮小を禁止
 * した場合に、デバイスの縦横表示の切替をくりかえすと、画面の表示がすこしずつ拡大して
 * いくという問題がある。(iOS6/iOS7での発生を確認)
 *
 * 本スクリプトでは、この問題を回避するためのものである。
 *
 * Safari10以降でmaximum-scaleを使用すると発生するレイアウト崩れに対応している。
 * iphoneはサイズが小さいため発生しない。
 * https://developer.apple.com/library/archive/releasenotes/General/WhatsNewInSafari/Articles/Safari_10_0.html#//apple_ref/doc/uid/TP40014305-CH11-SW1
 *
 * @author Iwauo Tajima
 * @module nablarch.ui.device
 */
define(['jquery', 'sugar'], function($) {'use strict';
  var device = window.nablarch_device.type
    , browser = window.nablarch_device.browser
    , majorBrowserVersion = parseInt(window.nablarch_device.browserVersion.split('_')[1])
    , fixedViewPort

  if (device !== 'iphone' && !(device === 'ipad' && browser === 'mobile_safari' && majorBrowserVersion <= 9)) {
    return;
  }

  fixedViewPort = (device === 'ipad')   ? "width=768px, minimum-scale=1.0, maximum-scale=1.0"
                : (device === 'iphone') ? "width=device-width, minimum-scale=1.0, maximum-scale=1.0"
                : null;

  $(function() {
    fixViewPort();
    $('body').on('gesturestart', fixViewPort);
  });

  // --- helper functions --- //
  function fixViewPort() {
    $('meta[name="viewport"]').attr('content', fixedViewPort);
  }
});

